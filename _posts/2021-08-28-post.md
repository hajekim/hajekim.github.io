---
title: "Amazon Athena S3 λ°μ΄ν„° λ΅λ“ μ‹ 'Header Skip' μ„¤μ • λ°©λ²•"
date: 2021-08-28 18:00:00 +0900
categories: AWS
tags: [AWS, Athena]
---
> **Amazon Athena & S3**
S3(Simple Storage Service)λ΅ AWSλ¥Ό λ€ν‘ν•λ” ν΄λΌμ°λ“ μ„λΉ„μ¤μ…λ‹λ‹¤. κ°μ²΄ μ¤ν† λ¦¬μ§€ (Object Storage)λΌλ” ν•νƒμ μ„λΉ„μ¤λ΅ μ¤ν† λ¦¬μ§€λ¥Ό μ¶”μƒν™”ν• ν•νƒλ΅μ¨ μ‚¬μ©μλ” λ°μ΄ν„°κ°€ μ–΄λ λΈ”λ­μ— μ €μ¥λλ”μ§€ μ• ν•„μ” μ—†μ΄ νΈλ¦¬ν•κ² μ‚¬μ© κ°€λ¥ν• μ¤ν† λ¦¬μ§€μ…λ‹λ‹¤. λ¬Όλ΅  OSμ— λ³Όλ¥¨ λ§μ΄νΈν•μ—¬ μ‚¬μ©λ„ κ°€λ¥ν•©λ‹λ‹¤! ν•μ§€λ§ I/O μ†λ„λ” λΈ”λ­ μ¤ν† λ¦¬μ§€μ— λΉ„ν•λ©΄ κ½¤ λλ¦° νΈμ…λ‹λ‹¤.  [MiniO](https://min.io/)λ¥Ό μ΄μ©ν•μ—¬ κ°μ²΄ μ¤ν† λ¦¬μ§€λ¥Ό κµ¬ν„ν•  μ μμµλ‹λ‹¤.
Athenaλ” Standard SQLμ„ μ΄μ©ν•μ—¬ S3μ— μ €μ¥λ λ°μ΄ν„°λ¥Ό κ°„λ‹¨ν•κ² μ§μν•  μ μλ” λ€ν™”ν• μΏΌλ¦¬ μ„λΉ„μ¤μ…λ‹λ‹¤.
HDFSμ—μ„ Hiveλ¥Ό μ΄μ©ν•μ—¬ SQL μ§μν•λ” κµ¬μ΅°μ™€ μ μ‚¬ν•κµ¬λ‚~ ν•κ³  μ΄ν•΄ν•μ‹λ©΄ μΆ‹μµλ‹λ‹¤ π¥³


## Preface
Amazon S3μ— μ €μ¥λ μ—¬λ¬ CSV λ°μ΄ν„°λ¥Ό Athenaμ—μ„ ν…μ΄λΈ”μ„ κµ¬μ„±ν•  λ•, 1λ² λΌμΈμΈ Headerκ°€ λ“¤μ–΄κ°€λ” μƒν™©μ„ λ€μ²ν•΄λ΄…μ‹λ‹¤.

## Pre-requirements
- Amazon Web Services μ–΄μΉ΄μ΄νΈ
- Amazon S3
- Amazon Athena

## Header Skip μ„¤μ •ν•κΈ°
Athenaμ—μ„ ν…μ΄λΈ”μ„ μƒμ„±ν•κ³ μ ν•λ” λ²„ν‚·μ— μ €μ¥λ CSV νμΌλ“¤μ„ λ¨Όμ € μ‚΄ν΄λ΄…μ‹λ‹¤.

μ¤ν‚¤λ§κ°€ μ „λ¶€ λ™μΌν•κ°€μ”?

κ·Έλ ‡λ‹¤λ©΄, μ•„λ νλΌλ―Έν„°λ¥Ό μ¶”κ°€ν•μ—¬ ν…μ΄λΈ” μƒμ„±ν•  λ• ν—¤λ”λ¥Ό μƒμ„±ν•  μ μλ„λ΅ μ„¤μ •ν•©μ‹λ‹¤.

### Ignoring Headers
```SQL
TBLPROPERTIES ('skip.header.line.count' = '1')
```
νλΌλ―Έν„°λ¥Ό μ…λ ¥ν•μ—¬ μ•„λμ™€ κ°™μ΄ μ…λ ¥ν•©λ‹λ‹¤.

### Query Sample

```SQL
CREATE EXTERNAL TABLE IF NOT EXISTS [TABLE] (
    `COLUMN_01` string,
    `COLUMN_02` int,
    `COLUMN_03` timestamp,
    `COLUMN_04` string
)
ROW FORMAT SERDE 'org.apache.hadoop.hive.serde2.lazy.LazySimpleSerDe'
WITH SERDEPROPERTIES (
    'serialization.format' = ',',
    'field.delim' = ','
) LOCATION 's3://athena-examples-myregion/flight/csv/';
TBLPROPERTIES (
    'skip.header.line.count' = '1'
)
```

Athenaμ—μ„ External Tableμ„ μƒμ„±ν•΄μ„ ν…μ¤νΈν•΄λ΄…μ‹λ‹¤.
λ” μ΄μƒ νμΌμ μ«μλ§νΌ Headerκ°’μ΄ Rowμ— μ¶”κ°€λμ§€ μ•κ³  μ¨μ „ν• κ°’μ΄ λ“¤μ–΄κ°€λ” κ²ƒμ„ ν™•μΈν•  μ μμµλ‹λ‹¤.

### Use case
![](https://images.velog.io/images/haje/post/bd4342cb-b165-4a6d-ab47-ad6163959900/athena-s3.png)

### μ°Έκ³  λ¬Έμ„
[AWS Athena Documents - LazySimpleSerDe for CSV, TSV, and Custom-Delimited Files - Ignoring Headers](https://docs.aws.amazon.com/athena/latest/ug/lazy-simple-serde.html#lazy-simple-serde-ignoring-headers)